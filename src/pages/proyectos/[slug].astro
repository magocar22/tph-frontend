---
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import ContactoForm from "../../components/Contacto.astro"; // Reutilizamos el form
import { Image } from "astro:assets";
import logoBlanco from "../../assets/tph-logo-blanco.png";

// 1. Esto genera todas las rutas estáticas al compilar
export async function getStaticPaths() {
  const proyectos = await getCollection("proyectos");
  return proyectos.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

// 2. Recuperamos los datos del proyecto actual
const { entry } = Astro.props;
const { Content } = await entry.render(); // Renderiza el markdown
---

<html lang="es">
  <head>
    <BaseHead
      title={`${entry.data.titulo} | Proyecto`}
      description={entry.data.descripcionCorta}
    />
  </head>
  <body class="bg-gray-50">
    <!-- HEADER CON IMAGEN DEL PROYECTO -->
    <header class="relative h-[50vh] min-h-[400px] flex items-end">
      <Image
        src={entry.data.imagenPrincipal}
        alt={entry.data.titulo}
        class="absolute inset-0 w-full h-full object-cover"
      />
      <div
        class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"
      >
      </div>

      <!-- Navbar flotante -->
      <div class="absolute top-0 w-full p-6 z-20">
        <a
          href="/proyectos"
          class="text-white font-bold flex items-center gap-2 hover:underline"
        >
          ← Volver al listado
        </a>
      </div>

      <div class="relative z-10 p-8 md:p-12 max-w-7xl mx-auto w-full">
        <span
          class="bg-blue-600 text-white px-4 py-1 rounded-full text-sm font-bold mb-4 inline-block"
        >
          {entry.data.estado}
        </span>
        <h1 class="text-4xl md:text-6xl font-bold text-white mb-2">
          {entry.data.titulo}
        </h1>
        <p class="text-xl text-gray-200 flex items-center">
          <svg
            class="w-5 h-5 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
            ></path><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg
          >
          {entry.data.ubicacion}
        </p>
      </div>
    </header>

    <main
      class="max-w-7xl mx-auto px-4 py-12 grid grid-cols-1 lg:grid-cols-3 gap-12"
    >
      <!-- COLUMNA IZQUIERDA: INFORMACIÓN (Markdown) -->
      <div class="lg:col-span-2">
        <article
          class="prose prose-blue prose-lg max-w-none bg-white p-8 rounded-2xl shadow-sm"
        >
          <!-- Aquí se inyecta el texto que escribiste en el .md -->
          <Content />
        </article>
      </div>

      <!-- COLUMNA DERECHA: CONTACTO -->
      <div class="lg:col-span-1">
        <div class="sticky top-8">
          <div class="bg-blue-600 text-white p-6 rounded-t-2xl">
            <h3 class="text-xl font-bold">¿Te interesa este proyecto?</h3>
            <p class="text-blue-100 text-sm mt-1">
              Solicita el dossier completo de {entry.data.titulo}.
            </p>
          </div>

          <div
            class="bg-white p-6 rounded-b-2xl shadow-lg border border-gray-100"
          >
            <!-- AQUÍ ESTÁ EL CAMBIO: Añadimos simple={true} -->
            <ContactoForm simple={true} />
          </div>
        </div>
      </div>
    </main>

    <Footer />
  </body>
</html>
